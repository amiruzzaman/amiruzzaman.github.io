<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="shortcut icon" href="#"/>
    <title>Convert Hexadecimal to ASCII</title>
    <style>
        .label1 {
            width: 200px;
            float: left;
            margin: 0 20px 0 0;
        }

        .label2 {
            width: 40px;
            float: left;
            margin: 0 20px 0 0;
        }

        span {
            display: block;
            margin: 0 0 3px;
            font-size: 1.2em;
            font-weight: bold;
        }

        input {
            width: 200px;
            border: 1px solid #000;
            padding: 5px;
        }

        select {
            width: 40px;
            border: 1px solid #000;
            padding: 5px;
        }
    </style>
</head>
<body>
    Enter your hexcode<br />
    <textarea id="inputhex" value="" rows="4" cols="50" onkeypress="onTestChange();" placeholder="0xef"></textarea>
    <!--<button id="sub">Submit</button>-->
    <button onclick="validate(document.getElementById('inputhex').value)" id="testButton">To ASCII</button>
    <button onclick="toDecimal(document.getElementById('inputhex').value)" id="testButton">To Decimal</button>
    <button onclick="toLittleEndian(document.getElementById('inputhex').value)" id="testButton">To little endian</button>
    <p id="demo"></p><br />
    <p id="demo2"></p>
    <div id="demop" style="background-color:powderblue;">This the ASCII</div><br />
    <div id="target">
        <!-- all divs will append here -->
    </div>
    <div id="demo2p" style="background-color:tomato;">This the REVERSE ASCII</div><br />
    <div id="target_reverse">
        <!-- all divs will append here -->
    </div>


    <label class = "label1" for="company">
        <span id="firstspan">First value</span>
        <input type="text" id="first" placeholder="0xef or 123" />
    </label>
    <label class = "label2" for="company">
        <span>+/-</span>
        <select name="op" id="op">
          <option value="+">+</option>
          <option value="-">-</option>
        </select>
    </label>
    <label class = "label1" for="contact">
        <span id="secondspan">Second value</span>
        <input type="text" id="second" placeholder="0xef or 123" />
    </label>
    <button type="submit"
            style="margin-right: 15px;"
            onClick="add()">
        Add hex values
    </button>
    <button type="submit"
            style="margin-right: 15px;"
            onClick="decimalToHex()">
        Decimal to hex
    </button>

    <button type="submit"
            style="margin-right: 15px;"
            onClick="decimalToBin()">
        Decimal to bin
    </button>
    <br/>
    <div id="addresult"></div>


    <script>
        function hex2a(hexx) {
            hexx = hexx.replace('0x', '');
            var hex = hexx.toString();//force conversion
            var str = '';
            for (var i = 0; i < hex.length; i += 2)
                str += String.fromCharCode(parseInt(hex.substr(i, 2), 16));
            return str;
        }
        //hex2a('32343630'); // returns '2460'
        //document.getElementById("demo").innerHTML = hex2a('0x90909062');

        function hex2ascii(hexx) {
            console.log(hexx);
            if (hexx === null || hexx === '') {
                return;
            } else {
                hexx = hexx.replace('0x', '');
                return hexx.match(/.{1,2}/g).reduce((acc, char) => acc + String.fromCharCode(parseInt(char, 16)), "")
            }
        }

        function reverse(s) {
            if (!s) return;
            let str = s;
            var reverse = '';
            for (var i = str.length; i > 0; i--) {

                var newstr = str.substring(0, i)
                reverse += newstr.substr(-1, 1)
            }
            return reverse;
        }

        var inputhex = document.getElementById("inputhex");
        inputhex.addEventListener("keydown", function (e) {
            if (e.keyCode === 13) {
                var t = document.getElementById('inputhex').value

                //var textArea = document.getElementById("my-text-area");
                //var arrayOfLines = textArea.value.split("\n"); // arrayOfLines is array where every element is string of one line

                //validate(t);
            }
        });

        function validate(e) {
            //alert('Validated: '+e);
            //console.log(e);
            var lines = e.split('\n');
            //console.log(lines);

            showInDivs(lines);

            //document.getElementById("demo").innerHTML = hex2ascii(e);
            //document.getElementById("demo2").innerHTML = reverse(hex2ascii(e));
        }

        function toDecimal(e) {
            //alert('Validated: '+e);
            //console.log(e);
            var lines = e.split('\n');
            //console.log(lines);

            showInDivsDecimal(lines);

            //document.getElementById("demo").innerHTML = hex2ascii(e);
            //document.getElementById("demo2").innerHTML = reverse(hex2ascii(e));
        }


        function toLittleEndian(e) {
            //alert('Validated: '+e);
            //console.log(e);
            var lines = e.split('\n');
            console.log(lines);
            
            // get the first one for now
            var str = lines[0];

            var linesLittleEndian = [];

            for(let j = 0; j<lines.length; j++){
                let s = littleEndianStr(lines[j]);
                linesLittleEndian.push(s);
            }

            console.log(linesLittleEndian);


            showInDivsLtEndian(linesLittleEndian);

            //document.getElementById("demo").innerHTML = hex2ascii(e);
            //document.getElementById("demo2").innerHTML = reverse(hex2ascii(e));
        }

        function littleEndianStr(str){
        
            str = str.replace('0x', '');

                var chunks = [];

                for (var i = 0, charsLength = str.length; i < charsLength; i += 2) {
                    chunks.push(str.substring(i, i + 2));
                }

                console.log(chunks);

                littleEndian = "";
                // reverse the array
                for(let c = chunks.length; c>=0; c--){
                    if(typeof chunks[c] !== "undefined"){
                        console.log("\\x"+chunks[c]);
                        littleEndian += "\\x"+chunks[c];
                    }
                }
                console.log(littleEndian);
            return littleEndian
        }
    </script>

    <script>

        function removeOldChildDiv(divId) {
            const myNode = document.getElementById(divId);
            while (myNode.firstChild) {
                myNode.removeChild(myNode.lastChild);
            }
        }
        function onTestChange() {
            var key = window.event.keyCode;

            // If the user has pressed enter
            if (key === 13) {
                //document.getElementById("inputhex").value = document.getElementById("inputhex").value + "\n*";

                var textArea = document.getElementById('inputhex');
                var lines = textArea.value.split('\n');    // lines is an array of strings

                showInDivs(lines);

                //document.appendChild(toAdd);
                return false;
            }
            else {
                return true;
            }
        }

        function showInDivs(lines) {

            removeOldChildDiv('target');
            document.getElementById('demop').innerHTML = "This the ASCII";

            var toAdd = document.getElementById('target')
            // Loop through all lines
            for (var j = 0; j < lines.length; j++) {
                //validate(lines[j]);
                console.log('Line ' + j + ' is ' + lines[j])

                if (lines[j] != null) {
                    var newDiv = document.createElement('div');
                    newDiv.id = 't' + j;
                    newDiv.className = 'ansbox';
                    newDiv.innerHTML += hex2ascii(lines[j])//'Extra stuff';
                    toAdd.appendChild(newDiv);
                }
            }


            removeOldChildDiv('target_reverse');
            document.getElementById('demo2p').innerHTML = "This the REVERSE ASCII";

            var toAdd = document.getElementById('target_reverse')
            // Loop through all lines
            for (var j = 0; j < lines.length; j++) {
                //validate(lines[j]);
                console.log('Line ' + j + ' is ' + lines[j])

                if (lines[j] != null) {
                    var newDiv = document.createElement('div');
                    newDiv.id = 'r' + j;
                    newDiv.className = 'ansbox';
                    newDiv.innerHTML += reverse(hex2ascii(lines[j]))//'Extra stuff';
                    toAdd.appendChild(newDiv);
                }
            }

        }


        function showInDivsLtEndian(lines) {

            removeOldChildDiv('target');
            document.getElementById('demop').innerHTML = "The little endian value";

            var toAdd = document.getElementById('target')
            // Loop through all lines
            for (var j = 0; j < lines.length; j++) {
                //validate(lines[j]);
                console.log('Line ' + j + ' is ' + lines[j])

                if (lines[j] != null) {
                    var newDiv = document.createElement('div');
                    newDiv.id = 't' + j;
                    newDiv.className = 'ansbox';
                    newDiv.innerHTML += lines[j];//'Extra stuff';
                    toAdd.appendChild(newDiv);
                }
          }
        }

        function showInDivsDecimal(lines) {

            removeOldChildDiv('target');
            document.getElementById('demop').innerHTML = "The decimal value";

            var toAdd = document.getElementById('target')
            // Loop through all lines
            for (var j = 0; j < lines.length; j++) {
                //validate(lines[j]);
                console.log('Line ' + j + ' is ' + lines[j])

                if (lines[j] != null) {
                    var newDiv = document.createElement('div');
                    newDiv.id = 't' + j;
                    newDiv.className = 'ansbox';
                    newDiv.innerHTML += hexToDec(lines[j])//'Extra stuff';
                    toAdd.appendChild(newDiv);
                }
            }


            removeOldChildDiv('target_reverse');
            /*
            var toAdd = document.getElementById('target_reverse')
            // Loop through all lines
            for (var j = 0; j < lines.length; j++) {
                //validate(lines[j]);
                console.log('Line ' + j + ' is ' + lines[j])

                if (lines[j] != null) {
                    var newDiv = document.createElement('div');
                    newDiv.id = 'r' + j;
                    newDiv.className = 'ansbox';
                    newDiv.innerHTML += reverse(hex2ascii(lines[j]))//'Extra stuff';
                    toAdd.appendChild(newDiv);
                }
            }
            */
        }


        function add() {


            var hexValue = document.getElementById('first').value;
            var a = document.getElementById('second').value
            var op = document.getElementById("op").value;
            console.log(op);

        document.getElementById('firstspan').innerHTML = "First hex value";
        document.getElementById('secondspan').innerHTML = "Second hex value";
        if (op == '+'){
            var resultHexValue = (parseInt(hexValue, 16) + parseInt(a, 16)).toString(16);
            document.getElementById('demop').innerHTML = hexValue + "+" + a;
        }else{
            var resultHexValue = (parseInt(hexValue, 16) - parseInt(a, 16)).toString(16);
            document.getElementById('demop').innerHTML = hexValue + "-" + a;
        }

            //document.writeln(hexValue); // outputs 'ababab'

            
            document.getElementById('demo2p').innerHTML = "0x"+resultHexValue;
            //document.getElementById('addresult').innerHTML = 'hello';
            //console.log('here');
        }


        function hexToDec(s) {
        s = s.replace('0x', '');
            var i, j, digits = [0], carry;
            for (i = 0; i < s.length; i += 1) {
                carry = parseInt(s.charAt(i), 16);
                for (j = 0; j < digits.length; j += 1) {
                    digits[j] = digits[j] * 16 + carry;
                    carry = digits[j] / 10 | 0;
                    digits[j] %= 10;
                }
                while (carry > 0) {
                    digits.push(carry % 10);
                    carry = carry / 10 | 0;
                }
            }
            return digits.reverse().join('');
        }

        function decimalToHex() {

        var input = (document.getElementById('first').value).toString();
        console.log(input);
        var d;
        //var a = document.getElementById('second').value

        var n = 8  // arbitrary length
        var arr = Array(n).fill(0)

        if (input.indexOf(',') > -1) { 
            d = input.split(',')[0];
            var padding = input.split(',')[1];

            const item = 0
            arr = Array.from({length: padding}, () => item)
            console.log('arr', arr)
        }else{
            d = input;
        }

        document.getElementById('firstspan').innerHTML = "Decimal value";
        document.getElementById('secondspan').innerHTML = "Hex value";

            //var d, padding = input.split(',');
            var hex = Number(d).toString(16);
            padding = typeof (padding) === "undefined" || padding === null ? padding = 2 : padding;

            while (hex.length < padding) {
                hex = "0" + hex;
            }
        console.log(hex);

        for(let i = arr.length; i>0; i--){
      
        }

        while (hex.length < arr.length) {
                hex = "0" + hex;
            }
        hex = "0x"+hex;
            document.getElementById('second').value = hex;
            //return hex;
        }
        
        function decimalToBin(){
        
            document.getElementById('firstspan').innerHTML = "Decimal value";
            document.getElementById('secondspan').innerHTML = "Bin value";

        //const numberToConvert = 5;
        var numberToConvert = document.getElementById('first').value;
        const numberOfBits = 32; // 32-bits binary
        const arrBitwise = [0]; // save the resulting bitwise

        for (let i=0; i<numberOfBits; i++) {
            let mask = 1;

            const bit = numberToConvert & (mask << i); // And bitwise with left shift

            if(bit === 0) {
                arrBitwise[i] = 0;
            } else {
                arrBitwise[i] = 1;
            }
        }

        const binary = arrBitwise.reverse().join("");

        console.log(`This is the resulting binary: ${binary}`)
        console.log(`This is the verification ${parseInt(binary, 2)}`);
         document.getElementById('second').value = binary;
           
        
        }

    </script>
</body>
</html>
